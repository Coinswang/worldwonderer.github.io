## 前言

近几年，各网站和App对核心内容的保护意识大大提高，反爬机制和风控的手段多种多样。移动互联网步入后半场，各厂倾向于在自家的APP中分发内容，PC/H5站点的内容正在萎缩，甚至消失不见。

对于爬虫（一个特殊的用户）来说，主战场变了，过去在浏览器端可能是解决一个JS加密，造一个代理IP池，加个验证码识别，字体、CSS反爬这种花里胡哨的就不提了。在App上，我们需要做什么？App逆向，你可能需要会脱壳，会反编译，会hook注入，会动态调试等等。

以为攻破加密算法，通讯协议就万事大吉吗？其实攻破协议是相对简单的，后边面对的还有风控，采集几百种设备的信息，记录无数次的用户行为判断你的设备特征是否正常，用户行为是否正常。从硬件底层信息采集，到大数据分析，可以说是“无微不至”了。

爬虫工程师的学习曲线陡峭了很多，可能前一天愉快的学会了Xpath，后一天就要面对逆向、图像识别。最近面试了很多爬虫工程师，同时自己也在找工作的过程中，从爬虫的基础模块开始梳理下一个合格的爬虫工程师需要具备的知识。

## 基础篇

### 代理模块
代理模块分为两种，一种是用来避免IP封禁的代理IP池，另一种是中间人代理服务，用于JS注入，Cookie\token获取和response拦截。

#### 常规代理IP
类型
* http代理
* https隧道代理
* https中间人代理

很多人对于https代理的概念是比较模糊的，这里具体讲一下https隧道代理和https中间人代理的差别。

https隧道代理，在客户端和服务端之间建立通道，转发TCP数据流，无需也无法知晓其中的具体内容。而https中间人代理，基于中间人攻击的思想，对客户端假装为目标服务端，对服务端假装为客户端。有个常见的应用场景是抓包，在抓https的包时，我们需要在客户端上信任证书，使得中间人代理成为一个受信的证书颁发机构，从而可以动态生成服务端证书，伪装为目标服务端。

来源

| 类型 | 价格 | 特性 |
|  ----  | ----  | ----  |
| 端口扫描（常说的免费代理IP） | 免费 | 代理IP量少有限，可用率低 |
| 蜂窝网络  | 低 | 海量代理IP，开发成本高 |
| 第三方代理服务，URL提取型 | 高 | 海量代理IP，一般可用率90%左右，开发成本中  |
| 第三方代理服务，动态隧道 | 高 | 海量代理IP，一般可用率90%左右，开发成本低，灵活性低  |
| 固定\弹性IP\拨号VPS | 高 | 代理IP量有限，稳定性高 |

对于成本有要求，同时对技术有自信，可以选择使用蜂窝网络建代理IP池。其余情况还是推荐使用第三方代理服务。这里有一篇评测第三方代理服务的文章，可以作为参考[十万火急的数据采集项目，爬虫代理测试对比](https://www.v2ex.com/t/537186)。

轮换策略

如何判定代理IP被封，是代理IP池的一个难点，一个HTTP请求失败有各种原因，Cookie失效，User-Agent被封，加密参数改版等等。如果没有判定出真正的原因，直接切换代理IP会造成浪费。实际中，在更换多次代理IP请求仍然无效时，应及时停止爬虫程序，并按P0等级报警。

调度策略

代理IP的调度策略需要结合网站的特点做选取和调整，一般实用的有这三种
1. 贪婪模式，在一个代理IP可以使用时，尽可能多的使用
2. 随机或轮询模式
3. 贪婪模式和随机模式结合，挑出若干个代理IP，并随机或轮询使用

#### 中间人代理服务
中间人代理服务的使用场景很多，以下有几个

* selenium驱动浏览器被检测到时，可以拦截并修改JS代码，绕过检测。另外这里提出一个新思路，在过去的文章中提到过，向JS注入websocket连接，实现浏览器和服务端的通信
* 模拟点击手机需要截获请求的response/Cookie/token

### Cookie模块

## 进阶篇

### 验证码识别

### 手机群控

### 浏览器集群

## 玄学篇

### 养号