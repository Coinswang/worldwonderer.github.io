## Dex file 文件结构
```shell
struct DexFile {
    directly-mapped "opt" header */
    // const DexOptHeader* pOptHeader;
 
    /*
        对应关系如下
        DexHeader*    pHeader   ---->struct header_item dex_header
        DexStringId*  pStringIds---->struct string_id_list dex_string_ids
        DexTypeId*    pTypeIds  ---->struct type_id_list dex_type_ids
        DexFieldId*   pFieldIds ---->struct field_id_list dex_field_ids
        DexMethodId*  pMethodIds---->struct method_id_list dex_method_ids
        DexProtoId*   pProtoIds ---->struct proto_id_list dex_proto_ids
        DexClassDef*  pClassDefs---->struct class_def_item_list dex_class_defs
        DexLink*      pLinkData ---->struct map_list_type dex_map_list
    */
 
    /* pointers to directly-mapped structs and arrays in base DEX */
     DexHeader*    pHeader;        // DEX 文件头，记录了一些当前文件的信息以及其他数据结构在文件中的偏移量
     DexStringId*  pStringIds;     // 数组,元素类型为string_id_item,存储字符串相关的信息
     DexTypeId*    pTypeIds;       // 数组,存储类型相关的信息
     DexFieldId*   pFieldIds;      // 数组,存储成员变量信息,包括变量名和类型等
     DexMethodId*  pMethodIds;     // 数组,存储成员函数信息包括函数名 参数和返回值类型
     DexProtoId*   pProtoIds;      // 数组,函数原型数据索引，记录了方法声明的字符串，返回类型和参数列表
     DexClassDef*  pClassDefs;     // 数组,存储类的信息
     DexLink*      pLinkData;      // Dex文件重要的数据内容都存在data区域内,一些数据结构会通过如 xx_off这样的成员变量只想文件的某个位置,从该位置开始,存储了对应的数据结构的内容,而xx_off的位置一般落在data区域内
 
    /*
     * These are mapped out of the "auxillary" section, and may not be
     * included in the file.
     */
    const DexClassLookup* pClassLookup;
    const void*         pRegisterMapPool;       // RegisterMapClassPool
 
    /* points to start of DEX file data */
    const u1*           baseAddr;
 
    /* track memory overhead for auxillary structures */
    int                 overhead;
 
    /* additional app-specific data structures associated with the DEX */
    //void*               auxData;
};
```

## 为什么使用Dex而不是Class
* Dex针对ARM CPU做了定制优化
* 单个文件，减少IO操作次数
* 减少冗余信息

## Dex和Class的差异
 
* 字节序，Class文件采用Big Endian，dex默认字节序为Little Endian
* Dex新增LEB128数据类型，减少空间占用
* 信息表述上有略微差异

## Python解析脚本

[read_dex.py](https://github.com/worldwonderer/dive-into-art/blob/master/read_dex.py)

## References

[The dex File Format](https://source.android.com/devices/tech/dalvik/dex-format.html)